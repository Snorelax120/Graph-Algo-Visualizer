<!DOCTYPE html>
<head>

</head>
<body>
<div id="container"></div>
<script type="module">

import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

const width = 1000;
const height = 1000;

const svg1 = d3.create('svg').attr('viewBox', [0, 0, width, height]);

const graph = {
    nodes: [
        { id: 'a' },
        { id: 'b' },
        { id: 'c' },
        { id: 'd' }
    ],
    edges: [
        ['b', 'c'],
        ['c', 'd'],
    ]
};

const simulation = d3.forceSimulation(graph.nodes)
    .force('charge', d3.forceManyBody().strength(-1000))
    .force('center', d3.forceCenter(width / 2, height / 2))
    .force('link', d3.forceLink(graph.edges).id(d => d.id).distance(200))
    .stop();

for (let i = 0; i < 300; i++) {
    simulation.tick();
}

const circleRadius = 50;
const circles = {};
graph.nodes.forEach(node => {
    const cx = node.x;
    const cy = node.y;
    const circle = svg1.append('circle')
        .attr('cx', cx)
        .attr('cy', cy)
        .attr('r', circleRadius)
        .attr('fill', 'green');
    circles[node.id] = circle;
        svg1.append('text')
            .attr('x', cx)
            .attr('y', '500')
            .attr('text-anchor', 'middle')
            .attr('dominant-baseline', 'central')
            .text(node)
            .attr('font-family', 'Arial')
            .attr('font-size', '15px')
            .attr('fill', 'black');
    });
    edges.forEach(([source, target]) => {
        const sourceCircle = circles[source];
        const targetCircle = circles[target];
        if (sourceCircle && targetCircle) {
            const x1 = parseFloat(sourceCircle.attr('cx')) + circleRadius;
            const y1 = parseFloat(sourceCircle.attr('cy'));
            const x2 = parseFloat(targetCircle.attr('cx')) - circleRadius;
            const y2 = parseFloat(targetCircle.attr('cy'));
            svg1.append('line')
                .attr('x1', x1)
                .attr('y1', y1)
                .attr('x2', x2)
                .attr('y2', y2)
                .attr('stroke', 'black')
                .attr('marker-end', 'url(#arrowhead)');
        }
    });


svg1.append('defs')
    .append('marker')
    .attr('id', 'arrowhead')
    .attr('viewBox', '-10 -10 20 20')
    .attr('markerWidth', 10)
    .attr('markerHeight', 10)
    .append('path')
    .attr('d', 'M-10,-6L0,0L-10,6')
    .style('fill', 'black');

const circles = appendCircles(svg1, graph);

const returnValue = svg1.node();

container.append(returnValue);

</script>
</body>
